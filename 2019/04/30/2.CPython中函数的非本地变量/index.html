<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>CPythonä¸­å‡½æ•°çš„éæœ¬åœ°å˜é‡ - æ€è€ƒè€…</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="ChenyangGao&#039;s Blog"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="ChenyangGao&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="å‡½æ•°å¯¹è±¡çš„ç‰¹æ®Šå±æ€§ NOTE å½“å‰æµ‹è¯•çš„CPythonè§£é‡Šå™¨ç‰ˆæœ¬ä¸º  123&amp;gt;&amp;gt;&amp;gt; print(__import__(&amp;#x27;sys&amp;#x27;).version)3.7.3 (default, Mar 27 2019, 16:54:48)[Clang 4.0.1 (tags&amp;#x2F;RELEASE_401&amp;#x2F;final)]  ä»¥å½“å‰ç‰ˆæœ¬çš„è§£é‡Šå™¨ä¸‹æ‰§è¡Œä¸‹é¢çš„ä»£ç ï¼Œå¯å¾—åˆ°ä¸€ä¸ªMarkdo"><meta property="og:type" content="blog"><meta property="og:title" content="CPythonä¸­å‡½æ•°çš„éæœ¬åœ°å˜é‡"><meta property="og:url" content="https://chenyanggao.github.io/2019/04/30/2.CPython%E4%B8%AD%E5%87%BD%E6%95%B0%E7%9A%84%E9%9D%9E%E6%9C%AC%E5%9C%B0%E5%8F%98%E9%87%8F/"><meta property="og:site_name" content="æ€è€ƒè€…"><meta property="og:description" content="å‡½æ•°å¯¹è±¡çš„ç‰¹æ®Šå±æ€§ NOTE å½“å‰æµ‹è¯•çš„CPythonè§£é‡Šå™¨ç‰ˆæœ¬ä¸º  123&amp;gt;&amp;gt;&amp;gt; print(__import__(&amp;#x27;sys&amp;#x27;).version)3.7.3 (default, Mar 27 2019, 16:54:48)[Clang 4.0.1 (tags&amp;#x2F;RELEASE_401&amp;#x2F;final)]  ä»¥å½“å‰ç‰ˆæœ¬çš„è§£é‡Šå™¨ä¸‹æ‰§è¡Œä¸‹é¢çš„ä»£ç ï¼Œå¯å¾—åˆ°ä¸€ä¸ªMarkdo"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.pixabay.com/photo/2014/11/23/21/22/snake-543243_640.jpg"><meta property="article:published_time" content="2019-04-30T14:36:10.000Z"><meta property="article:modified_time" content="2025-08-20T09:56:18.602Z"><meta property="article:author" content="ChenyangGao"><meta property="article:tag" content="Python"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://cdn.pixabay.com/photo/2014/11/23/21/22/snake-543243_640.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://chenyanggao.github.io/2019/04/30/2.CPython%E4%B8%AD%E5%87%BD%E6%95%B0%E7%9A%84%E9%9D%9E%E6%9C%AC%E5%9C%B0%E5%8F%98%E9%87%8F/"},"headline":"CPythonä¸­å‡½æ•°çš„éæœ¬åœ°å˜é‡","image":["https://cdn.pixabay.com/photo/2014/11/23/21/22/snake-543243_640.jpg"],"datePublished":"2019-04-30T14:36:10.000Z","dateModified":"2025-08-20T09:56:18.602Z","author":{"@type":"Person","name":"ChenyangGao"},"publisher":{"@type":"Organization","name":"æ€è€ƒè€…","logo":{"@type":"ImageObject"}},"description":"å‡½æ•°å¯¹è±¡çš„ç‰¹æ®Šå±æ€§ NOTE å½“å‰æµ‹è¯•çš„CPythonè§£é‡Šå™¨ç‰ˆæœ¬ä¸º  123&gt;&gt;&gt; print(__import__(&#x27;sys&#x27;).version)3.7.3 (default, Mar 27 2019, 16:54:48)[Clang 4.0.1 (tags&#x2F;RELEASE_401&#x2F;final)]  ä»¥å½“å‰ç‰ˆæœ¬çš„è§£é‡Šå™¨ä¸‹æ‰§è¡Œä¸‹é¢çš„ä»£ç ï¼Œå¯å¾—åˆ°ä¸€ä¸ªMarkdo"}</script><link rel="canonical" href="https://chenyanggao.github.io/2019/04/30/2.CPython%E4%B8%AD%E5%87%BD%E6%95%B0%E7%9A%84%E9%9D%9E%E6%9C%AC%E5%9C%B0%E5%8F%98%E9%87%8F/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">æ€è€ƒè€…</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item search" title="æœç´¢" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="https://cdn.pixabay.com/photo/2014/11/23/21/22/snake-543243_640.jpg" alt="CPythonä¸­å‡½æ•°çš„éæœ¬åœ°å˜é‡"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2019-04-30T14:36:10.000Z" title="2019/4/30 22:36:10">2019-04-30</time>å‘è¡¨</span><span class="level-item"><time dateTime="2025-08-20T09:56:18.602Z" title="2025/8/20 17:56:18">2025-08-20</time>æ›´æ–°</span><span class="level-item"> ChenyangGao </span><span class="level-item"><a class="link-muted" href="/categories/%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3/">ç¼–ç¨‹æ€æƒ³</a></span><span class="level-item">34 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦5134ä¸ªå­—)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>æ¬¡è®¿é—®</span></div></div><h1 class="title is-3 is-size-4-mobile">CPythonä¸­å‡½æ•°çš„éæœ¬åœ°å˜é‡</h1><div class="content"><h2 id="å‡½æ•°å¯¹è±¡çš„ç‰¹æ®Šå±æ€§"><a href="#å‡½æ•°å¯¹è±¡çš„ç‰¹æ®Šå±æ€§" class="headerlink" title="å‡½æ•°å¯¹è±¡çš„ç‰¹æ®Šå±æ€§"></a>å‡½æ•°å¯¹è±¡çš„ç‰¹æ®Šå±æ€§</h2><blockquote>
<p><strong>NOTE</strong> å½“å‰æµ‹è¯•çš„<kbd>CPython</kbd>è§£é‡Šå™¨ç‰ˆæœ¬ä¸º</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">__import__</span>(<span class="string">&#x27;sys&#x27;</span>).version)</span><br><span class="line"><span class="number">3.7</span><span class="number">.3</span> (default, Mar <span class="number">27</span> <span class="number">2019</span>, <span class="number">16</span>:<span class="number">54</span>:<span class="number">48</span>)</span><br><span class="line">[Clang <span class="number">4.0</span><span class="number">.1</span> (tags/RELEASE_401/final)]</span><br></pre></td></tr></table></figure>

<p>ä»¥å½“å‰ç‰ˆæœ¬çš„è§£é‡Šå™¨ä¸‹æ‰§è¡Œä¸‹é¢çš„ä»£ç ï¼Œå¯å¾—åˆ°ä¸€ä¸ª<kbd>Markdown</kbd>è¡¨æ ¼</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">outer</span>(<span class="params">freevar=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner</span>(<span class="params">a, b: <span class="built_in">int</span>=<span class="number">1</span>, *args, c: <span class="built_in">str</span>=<span class="string">&#x27;1&#x27;</span>, **kwds</span>) -&gt; <span class="built_in">tuple</span>:</span><br><span class="line">        <span class="string">&#x27;a test function&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> freevar, a, b, args, c, kwds</span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line">fn = outer()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;attribute&#x27;</span>, <span class="string">&#x27;type&#x27;</span>, <span class="string">&#x27;setable&#x27;</span>, <span class="string">&#x27;reason&#x27;</span>, sep=<span class="string">&#x27; | &#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(*<span class="string">&#x27;-&#x27;</span>*<span class="number">4</span>, sep=<span class="string">&#x27; | &#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> attr <span class="keyword">in</span> <span class="built_in">dir</span>(fn):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        obj = <span class="built_in">getattr</span>(fn, attr)</span><br><span class="line">        <span class="built_in">setattr</span>(fn, attr, obj)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;`%s`&#x27;</span>%attr, <span class="built_in">type</span>(obj), <span class="literal">True</span>, <span class="string">&#x27;&#x27;</span>, sep=<span class="string">&#x27; | &#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> exc: </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;`%s`&#x27;</span>%attr, <span class="built_in">type</span>(obj), <span class="literal">False</span>, <span class="string">&#x27;`%s`&#x27;</span>%exc, sep=<span class="string">&#x27; | &#x27;</span>)</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>attribute</th>
<th>type</th>
<th>setable</th>
<th>reason</th>
</tr>
</thead>
<tbody><tr>
<td><code>__annotations__</code></td>
<td>&lt;class â€˜dictâ€™&gt;</td>
<td>True</td>
<td></td>
</tr>
<tr>
<td><code>__call__</code></td>
<td>&lt;class â€˜method-wrapperâ€™&gt;</td>
<td>True</td>
<td></td>
</tr>
<tr>
<td><code>__class__</code></td>
<td>&lt;class â€˜typeâ€™&gt;</td>
<td>False</td>
<td><code>__class__ assignment only supported for heap types or ModuleType subclasses</code></td>
</tr>
<tr>
<td><code>__closure__</code></td>
<td>&lt;class â€˜tupleâ€™&gt;</td>
<td>False</td>
<td><code>readonly attribute</code></td>
</tr>
<tr>
<td><code>__code__</code></td>
<td>&lt;class â€˜codeâ€™&gt;</td>
<td>True</td>
<td></td>
</tr>
<tr>
<td><code>__defaults__</code></td>
<td>&lt;class â€˜tupleâ€™&gt;</td>
<td>True</td>
<td></td>
</tr>
<tr>
<td><code>__delattr__</code></td>
<td>&lt;class â€˜method-wrapperâ€™&gt;</td>
<td>True</td>
<td></td>
</tr>
<tr>
<td><code>__dict__</code></td>
<td>&lt;class â€˜dictâ€™&gt;</td>
<td>True</td>
<td></td>
</tr>
<tr>
<td><code>__dir__</code></td>
<td>&lt;class â€˜builtin_function_or_methodâ€™&gt;</td>
<td>True</td>
<td></td>
</tr>
<tr>
<td><code>__doc__</code></td>
<td>&lt;class â€˜strâ€™&gt;</td>
<td>True</td>
<td></td>
</tr>
<tr>
<td><code>__eq__</code></td>
<td>&lt;class â€˜method-wrapperâ€™&gt;</td>
<td>True</td>
<td></td>
</tr>
<tr>
<td><code>__format__</code></td>
<td>&lt;class â€˜builtin_function_or_methodâ€™&gt;</td>
<td>True</td>
<td></td>
</tr>
<tr>
<td><code>__ge__</code></td>
<td>&lt;class â€˜method-wrapperâ€™&gt;</td>
<td>True</td>
<td></td>
</tr>
<tr>
<td><code>__get__</code></td>
<td>&lt;class â€˜method-wrapperâ€™&gt;</td>
<td>True</td>
<td></td>
</tr>
<tr>
<td><code>__getattribute__</code></td>
<td>&lt;class â€˜method-wrapperâ€™&gt;</td>
<td>True</td>
<td></td>
</tr>
<tr>
<td><code>__globals__</code></td>
<td>&lt;class â€˜dictâ€™&gt;</td>
<td>False</td>
<td><code>readonly attribute</code></td>
</tr>
<tr>
<td><code>__gt__</code></td>
<td>&lt;class â€˜method-wrapperâ€™&gt;</td>
<td>True</td>
<td></td>
</tr>
<tr>
<td><code>__hash__</code></td>
<td>&lt;class â€˜method-wrapperâ€™&gt;</td>
<td>True</td>
<td></td>
</tr>
<tr>
<td><code>__init__</code></td>
<td>&lt;class â€˜method-wrapperâ€™&gt;</td>
<td>True</td>
<td></td>
</tr>
<tr>
<td><code>__init_subclass__</code></td>
<td>&lt;class â€˜builtin_function_or_methodâ€™&gt;</td>
<td>True</td>
<td></td>
</tr>
<tr>
<td><code>__kwdefaults__</code></td>
<td>&lt;class â€˜dictâ€™&gt;</td>
<td>True</td>
<td></td>
</tr>
<tr>
<td><code>__le__</code></td>
<td>&lt;class â€˜method-wrapperâ€™&gt;</td>
<td>True</td>
<td></td>
</tr>
<tr>
<td><code>__lt__</code></td>
<td>&lt;class â€˜method-wrapperâ€™&gt;</td>
<td>True</td>
<td></td>
</tr>
<tr>
<td><code>__module__</code></td>
<td>&lt;class â€˜strâ€™&gt;</td>
<td>True</td>
<td></td>
</tr>
<tr>
<td><code>__name__</code></td>
<td>&lt;class â€˜strâ€™&gt;</td>
<td>True</td>
<td></td>
</tr>
<tr>
<td><code>__ne__</code></td>
<td>&lt;class â€˜method-wrapperâ€™&gt;</td>
<td>True</td>
<td></td>
</tr>
<tr>
<td><code>__new__</code></td>
<td>&lt;class â€˜builtin_function_or_methodâ€™&gt;</td>
<td>True</td>
<td></td>
</tr>
<tr>
<td><code>__qualname__</code></td>
<td>&lt;class â€˜strâ€™&gt;</td>
<td>True</td>
<td></td>
</tr>
<tr>
<td><code>__reduce__</code></td>
<td>&lt;class â€˜builtin_function_or_methodâ€™&gt;</td>
<td>True</td>
<td></td>
</tr>
<tr>
<td><code>__reduce_ex__</code></td>
<td>&lt;class â€˜builtin_function_or_methodâ€™&gt;</td>
<td>True</td>
<td></td>
</tr>
<tr>
<td><code>__repr__</code></td>
<td>&lt;class â€˜method-wrapperâ€™&gt;</td>
<td>True</td>
<td></td>
</tr>
<tr>
<td><code>__setattr__</code></td>
<td>&lt;class â€˜method-wrapperâ€™&gt;</td>
<td>True</td>
<td></td>
</tr>
<tr>
<td><code>__sizeof__</code></td>
<td>&lt;class â€˜builtin_function_or_methodâ€™&gt;</td>
<td>True</td>
<td></td>
</tr>
<tr>
<td><code>__str__</code></td>
<td>&lt;class â€˜method-wrapperâ€™&gt;</td>
<td>True</td>
<td></td>
</tr>
<tr>
<td><code>__subclasshook__</code></td>
<td>&lt;class â€˜builtin_function_or_methodâ€™&gt;</td>
<td>True</td>
<td></td>
</tr>
</tbody></table>
<span id="more"></span>

<h2 id="å‘½åç©ºé—´å’Œä½œç”¨åŸŸ"><a href="#å‘½åç©ºé—´å’Œä½œç”¨åŸŸ" class="headerlink" title="å‘½åç©ºé—´å’Œä½œç”¨åŸŸ"></a>å‘½åç©ºé—´å’Œä½œç”¨åŸŸ</h2><blockquote>
<p><strong>NOTE</strong> åœ¨ä¼ ç»Ÿçš„ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œä½œç”¨åŸŸï¼ˆscopeï¼‰å°±æ˜¯ä¸€æ®µç¨‹åºä»£ç ä¸­æ‰€ç”¨åˆ°çš„åå­—è¢«é™åˆ¶çš„å¯ç”¨èŒƒå›´ã€‚æœ¬åœ°ï¼ˆå±€éƒ¨ï¼Œlocalï¼‰ä½œç”¨åŸŸè¢«é™åˆ¶åœ¨å—æˆ–å‡½æ•°ä½“å†…ï¼Œè€Œå…¨å±€ï¼ˆglobalï¼‰ä½œç”¨åŸŸè¢«é™åˆ¶åœ¨æœ¬åœ°ä»¥ä¸Šæœ€é•¿å¯è¾¾ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸç»“æŸã€‚æœ‰äº›ç¼–ç¨‹è¯­è¨€å…è®¸ï¼Œåœ¨æœ¬åœ°ä½œç”¨åŸŸå†…æ„å»ºä¸€ä¸ªæ›´ä½å±‚æ¬¡çš„æœ¬åœ°ä½œç”¨åŸŸï¼Œä½å±‚ä½œç”¨åŸŸè®¿é—®ä¸€ä¸ªéæœ¬åœ°çš„åå­—ï¼Œå®ƒå°±ä¼šåˆ°è¾ƒé«˜å±‚ä¸­å¯»æ‰¾ï¼Œé€å±‚å¾€ä¸Šï¼Œç›´åˆ°æ‰¾åˆ°æˆ–è€…æœ€ç»ˆä¸èƒ½æ‰¾åˆ°ã€‚ä½†æ˜¯è¿™ä¼šå¼•å‡ºä¸€ä¸ªé—®é¢˜ï¼šå®šä¹‰åœ¨ä¸€ä¸ªå‡½æ•°<code>outer</code>å†…çš„å‡½æ•°<code>inner</code>è¢«ä½œä¸ºè¿”å›å€¼ï¼Œ<code>inner</code>ä¸­å¼•ç”¨äº†<code>inner</code>ä¸­æ²¡æœ‰è€Œåœ¨<code>outer</code>ä¸­æœ‰çš„åå­—ï¼Œä¸ºäº†ä¿è¯ç†è®ºä¸Šçš„æŸäº›ä¸€è‡´æ€§ï¼Œæ˜¯å¦è¦æ±‚ç¼–è¯‘å™¨æä¾›ä¸€ç§è¢«ç§°ä¸ºé—­åŒ…ï¼ˆclosureï¼‰çš„æœºåˆ¶ï¼š<code>outer</code>ä¸­çš„è¿™äº›åå­—åŠå…¶å¼•ç”¨åº”è¯¥ç»§ç»­ä¿ç•™åœ¨ä¸€ä¸ªå¯è¢«<code>inner</code>è®¿é—®ä½†å¯¹æ›´é«˜å±‚ä½œç”¨åŸŸéšè—ï¼ˆå¹¶éæŒ‡ç»å¯¹ä¸èƒ½è¢«æ›´é«˜å±‚å‘ç°ï¼‰ã€‚<br>ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¿…å®šä¼šå¤„äºæŸä¸ªä½œç”¨åŸŸä¸­ï¼Œä½œç”¨åŸŸå…¶å®æ˜¯åœ¨ç»´æŠ¤ä¸€äº›åå­—å¯¹ä¸€äº›èµ„æºçš„å ç”¨å…³ç³»ã€‚ä¸€æ—¦ç¨‹åºç¦»å¼€æŸä¸ªä½œç”¨åŸŸï¼Œé‚£ä¹ˆæ³¨é”€å…¶ä¸­çš„åå­—å’Œé‡Šæ”¾å¯¹ç›¸å…³èµ„æºçš„å ç”¨å¾€å¾€è¢«è®¤ä¸ºæ˜¯å”¯ä¸€æ­£ç¡®çš„ã€‚<br>åœ¨<kbd>CPython</kbd>ä¸­ï¼Œå‘½åç©ºé—´ï¼ˆnamespaceï¼‰å’Œä½œç”¨åŸŸè™½ç„¶è”ç³»ç´§å¯†ï¼Œä½†å´æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µã€‚åœ¨ä¼ ç»Ÿçš„ç¼–ç¨‹è¯­è¨€<kbd>C</kbd>ä¸­ï¼Œå…¨å±€ä½œç”¨åŸŸå»ºç«‹åœ¨å †ä¸Šï¼Œè€Œæœ¬åœ°ä½œç”¨åŸŸå»ºç«‹åœ¨æ ˆä¸Šï¼Œä½†æ˜¯åœ¨<kbd>Python</kbd>ä¸­ï¼Œå‘½åç©ºé—´å®é™…ä¸Šå°±æ˜¯ä¸ªå­—å…¸ï¼Œè€Œå›æ”¶èµ„æºåˆæ˜¯å¦ä¸€å›äº‹äº†ï¼Œä¸å†æ˜¯â€œé”€æ¯â€ï¼Œåªæ˜¯â€œè§£é™¤â€å¯¹èµ„æºçš„å¼•ç”¨å…³ç³»ã€‚å¯¹èµ„æºçš„ç®¡ç†åŸºäºå¦ä¸€å¥—æœºåˆ¶ï¼ˆå¼•ç”¨è®¡æ•°å’Œåƒåœ¾å›æ”¶ï¼‰ï¼Œå®ƒä»£ç†äº†èµ„æºçš„åˆ›å»ºå’Œé”€æ¯çš„æ“ä½œï¼Œå®ƒä¾é å»ºç«‹ç»Ÿè®¡ä¿¡æ¯æ¥å®ç°æœ‰æ•ˆçš„ç®¡ç†ã€‚<br>ç›¸å…³çš„æƒ…å†µéå¸¸å¤æ‚ï¼Œä½†ç®€å•æ¥è¯´ï¼šæ›´æ–°å…¨å±€å‘½åç©ºé—´<code>globals()</code>ï¼Œä¼šæ”¹å˜æ¨¡å—çº§åˆ«ä½œç”¨åŸŸä¸­ç›¸åº”å˜é‡çš„å€¼ï¼Œä½†æ˜¯æ›´æ–°æœ¬åœ°å‘½åç©ºé—´<code>locals()</code>ï¼Œå…¶å®é™…æ•ˆæœè§†æ‰€å¤„æƒ…å†µä¼šæœ‰æ‰€ä¸åŒã€‚åœ¨å‡½æ•°å†…è¿˜å¯ä»¥æœ‰æœ¬åœ°ä½œç”¨åŸŸä¸€è¯´ï¼Œä½†æ¨¡å—çº§åˆ«è¿˜æ˜¯ä½äºä¼ ç»Ÿçš„å…¨å±€æ¦‚å¿µçš„ï¼Œåœ¨å…¶ä¸Šå°šæœ‰<code>builtins</code>ä¸€çº§ï¼Œè€Œä¸”è§£é™¤ä¸€ä¸ªæ¨¡å—å¯¹èµ„æºçš„å ç”¨å…³ç³»æ›´æ˜¯è½»è€Œæ˜“ä¸¾ã€‚å‘½åç©ºé—´ä¹Ÿå­˜åœ¨ä½çº§å¯¹é«˜çº§çš„é®ç›–ï¼Œè¿™åœ¨é¢å‘å¯¹è±¡ä¸­ç”šè‡³å¯ç”¨æ¥å®ç°å¤šæ€ï¼ˆpolymorphismï¼‰ã€‚</p>
</blockquote>
<blockquote>
<p><strong>NOTE</strong> <kbd>CPython</kbd>ä¸­å¯¹åå­—çš„å¯»æ‰¾é¡ºåºï¼š<code>locals</code> &gt; <code>closure</code> &gt; <code>globals</code> &gt; <code>builtins</code></p>
</blockquote>
<h3 id="1-å…¨å±€å‘½åç©ºé—´å’Œæ¨¡å—ä½œç”¨åŸŸ"><a href="#1-å…¨å±€å‘½åç©ºé—´å’Œæ¨¡å—ä½œç”¨åŸŸ" class="headerlink" title="1. å…¨å±€å‘½åç©ºé—´å’Œæ¨¡å—ä½œç”¨åŸŸ"></a>1. å…¨å±€å‘½åç©ºé—´å’Œæ¨¡å—ä½œç”¨åŸŸ</h3><blockquote>
<p>æ›´æ–°å…¨å±€å‘½åç©ºé—´<code>globals()</code>ï¼Œä¼šåŒæ—¶æ›´æ–°æ¨¡å—ä½œç”¨åŸŸä¸­çš„å˜é‡</p>
</blockquote>
<hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>val = <span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">globals</span>()[<span class="string">&#x27;val&#x27;</span>] = <span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>val</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="2-æ¨¡å—ä½œç”¨åŸŸä¸­çš„æœ¬åœ°å‘½åç©ºé—´"><a href="#2-æ¨¡å—ä½œç”¨åŸŸä¸­çš„æœ¬åœ°å‘½åç©ºé—´" class="headerlink" title="2. æ¨¡å—ä½œç”¨åŸŸä¸­çš„æœ¬åœ°å‘½åç©ºé—´"></a>2. æ¨¡å—ä½œç”¨åŸŸä¸­çš„æœ¬åœ°å‘½åç©ºé—´</h3><blockquote>
<p>åœ¨æ¨¡å—ä½œç”¨åŸŸä¸­ï¼Œæœ¬åœ°å‘½åç©ºé—´<code>locals()</code>ç­‰åŒäºå…¨å±€å‘½åç©ºé—´<code>globals()</code></p>
</blockquote>
<hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">locals</span>() <span class="keyword">is</span> <span class="built_in">globals</span>()</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>val = <span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">locals</span>()[<span class="string">&#x27;val&#x27;</span>] = <span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>val</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="3-å‡½æ•°æœ¬åœ°ä½œç”¨åŸŸä¸­çš„æœ¬åœ°å‘½åç©ºé—´"><a href="#3-å‡½æ•°æœ¬åœ°ä½œç”¨åŸŸä¸­çš„æœ¬åœ°å‘½åç©ºé—´" class="headerlink" title="3.  å‡½æ•°æœ¬åœ°ä½œç”¨åŸŸä¸­çš„æœ¬åœ°å‘½åç©ºé—´"></a>3.  å‡½æ•°æœ¬åœ°ä½œç”¨åŸŸä¸­çš„æœ¬åœ°å‘½åç©ºé—´</h3><blockquote>
<p>åœ¨æœ¬åœ°ä½œç”¨åŸŸä¸­ï¼Œæœ¬åœ°å‘½åç©ºé—´<code>locals()</code>çš„æ›´æ–°å¹¶ä¸å½±å“æœ¬åœ°ä½œç”¨åŸŸä¸­å˜é‡çš„å€¼ï¼Œåä¹‹ä¸ç„¶</p>
</blockquote>
<hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">fn</span>():</span><br><span class="line">    val = <span class="number">0</span></span><br><span class="line">    <span class="built_in">locals</span>()[<span class="string">&#x27;val&#x27;</span>] = <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> val</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>fn()</span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">fn</span>():</span><br><span class="line">    val = <span class="number">0</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">locals</span>()[<span class="string">&#x27;val&#x27;</span>])</span><br><span class="line">    val = <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">locals</span>()[<span class="string">&#x27;val&#x27;</span>])</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>fn()</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>

<hr>
<blockquote>
<p>æœ¬åœ°å‘½åç©ºé—´<code>locals()</code>åŒ…å«æœ¬åœ°ä½œç”¨åŸŸçš„åç§°å’Œè‡ªç”±å˜é‡</p>
</blockquote>
<hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">outer</span>():</span><br><span class="line">    nval = <span class="number">0</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner</span>():</span><br><span class="line">        <span class="keyword">global</span> gval</span><br><span class="line">        <span class="keyword">nonlocal</span> nval</span><br><span class="line">        lval = <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">locals</span>()</span><br><span class="line">    <span class="keyword">return</span> inner</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>gval = <span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>outer()() <span class="comment"># âš ï¸ æ³¨æ„ç»“æœçš„é¡ºåº</span></span><br><span class="line">&#123;<span class="string">&#x27;lval&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;nval&#x27;</span>: <span class="number">0</span>&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="4-æœ¬åœ°å‘½åç©ºé—´å’Œæœ¬åœ°ä½œç”¨åŸŸçš„æ›´æ–°å¯¹é—­åŒ…çš„å½±å“"><a href="#4-æœ¬åœ°å‘½åç©ºé—´å’Œæœ¬åœ°ä½œç”¨åŸŸçš„æ›´æ–°å¯¹é—­åŒ…çš„å½±å“" class="headerlink" title="4. æœ¬åœ°å‘½åç©ºé—´å’Œæœ¬åœ°ä½œç”¨åŸŸçš„æ›´æ–°å¯¹é—­åŒ…çš„å½±å“"></a>4. æœ¬åœ°å‘½åç©ºé—´å’Œæœ¬åœ°ä½œç”¨åŸŸçš„æ›´æ–°å¯¹é—­åŒ…çš„å½±å“</h3><blockquote>
<p>å’Œåœ¨æœ¬åœ°ä½œç”¨åŸŸçš„èµ‹å€¼ä¸åŒï¼Œå¯¹æœ¬åœ°å‘½åç©ºé—´<code>locals()</code>çš„æ›´æ–°ï¼Œä¸èƒ½ä¸ºé—­åŒ…æ‰€ä¾¦æµ‹å’Œä½¿ç”¨</p>
</blockquote>
<hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">val = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">outer</span>(<span class="params">mapping</span>):</span><br><span class="line">    <span class="built_in">locals</span>().update(mapping)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner</span>():</span><br><span class="line">        <span class="keyword">return</span> val</span><br><span class="line">    <span class="keyword">return</span> inner</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>outer(<span class="built_in">dict</span>(val=<span class="number">1</span>))()</span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">outer</span>(<span class="params">mapping</span>):</span><br><span class="line">    val = <span class="number">0</span></span><br><span class="line">    <span class="built_in">locals</span>().update(mapping)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner</span>():</span><br><span class="line">        <span class="keyword">return</span> val</span><br><span class="line">    <span class="keyword">return</span> inner</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>outer(<span class="built_in">dict</span>(val=<span class="number">1</span>))()</span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure>

<hr>
<blockquote>
<p>å¹¶ä¸”åœ¨æœ¬åœ°ä½œç”¨åŸŸçš„èµ‹å€¼ï¼Œå¿…é¡»æ˜¯æ˜¾å¼çš„ï¼Œä½¿ç”¨<code>exec</code>å’Œ<code>eval</code>ï¼ŒåŒæ ·åªä¼šæ›´æ–°ç›¸åº”çš„<code>gloabls</code>å’Œ<code>locals</code></p>
</blockquote>
<hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">outer</span>(<span class="params">mapping</span>):</span><br><span class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> <span class="built_in">tuple</span>(mapping):</span><br><span class="line">        <span class="built_in">exec</span>(<span class="string">f&#x27;<span class="subst">&#123;key&#125;</span>=<span class="subst">&#123;key&#125;</span>&#x27;</span>, mapping, <span class="built_in">locals</span>())</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner</span>():</span><br><span class="line">        <span class="keyword">return</span> val</span><br><span class="line">    <span class="keyword">return</span> inner</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>outer(<span class="built_in">dict</span>(val=<span class="number">1</span>))()</span><br><span class="line">NameError: name <span class="string">&#x27;val&#x27;</span> <span class="keyword">is</span> <span class="keyword">not</span> defined</span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">outer</span>(<span class="params">mapping</span>):</span><br><span class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> <span class="built_in">tuple</span>(mapping):</span><br><span class="line">        <span class="built_in">eval</span>(<span class="built_in">compile</span>(<span class="string">f&#x27;<span class="subst">&#123;key&#125;</span>=<span class="subst">&#123;key&#125;</span>&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;single&#x27;</span>), mapping, <span class="built_in">locals</span>())</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner</span>():</span><br><span class="line">        <span class="keyword">return</span> val</span><br><span class="line">    <span class="keyword">return</span> inner</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>outer(<span class="built_in">dict</span>(val=<span class="number">1</span>))()</span><br><span class="line">NameError: name <span class="string">&#x27;val&#x27;</span> <span class="keyword">is</span> <span class="keyword">not</span> defined</span><br></pre></td></tr></table></figure>

<hr>
<blockquote>
<p>æ€»è€Œè¨€ä¹‹ï¼Œç¼–ç¨‹è¯­è¨€ä½œä¸ºç¼–è¯‘å™¨æˆ–è§£é‡Šå™¨çš„é…ç½®æ–‡ä»¶ï¼Œç¼–ç¨‹è¯­è¨€çš„è¡Œä¸ºä¼šå—åˆ°è§£é‡Šå™¨æˆ–ç¼–è¯‘å™¨å®ç°æ–¹å¼çš„é™åˆ¶ã€‚åœ¨<kbd>CPython</kbd>çš„å®ç°ä¸­ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯è®¤ä¸ºï¼Œæœ¬åœ°ä½œç”¨åŸŸæ˜¯é™æ€çš„ï¼Œæœ¬åœ°å‘½åç©ºé—´æ˜¯åŠ¨æ€çš„ï¼Œå¯¹æœ¬åœ°ä½œç”¨åŸŸæ›´æ–°çš„è¿‡ç¨‹ï¼Œåœ¨ç¼–è¯‘æ—¶å°±å·²ç»ç¡®å®šäº†ï¼Œè€Œåœ¨è¿è¡Œæ—¶æ›´æ–°æœ¬åœ°å‘½åç©ºé—´å’ŒåŠ¨æ€ç¼–è¯‘ä»£ç æ‰§è¡Œï¼Œåªä¼šå½±å“ä¸€äº›åŠ¨æ€çš„å±€é¢ã€‚</p>
</blockquote>
<h2 id="å‡½æ•°åˆ©ç”¨ç¼“å­˜çš„ç ”ç©¶"><a href="#å‡½æ•°åˆ©ç”¨ç¼“å­˜çš„ç ”ç©¶" class="headerlink" title="å‡½æ•°åˆ©ç”¨ç¼“å­˜çš„ç ”ç©¶"></a>å‡½æ•°åˆ©ç”¨ç¼“å­˜çš„ç ”ç©¶</h2><blockquote>
<p><strong>NOTE</strong> ä¸€èˆ¬åœ°è®²ï¼Œç³»ç»Ÿ<code>A</code>å’Œç³»ç»Ÿ<code>B</code>ä¹‹é—´æœ‰é€šä¿¡ï¼Œ<code>B</code>å¯å­˜å‚¨<code>A</code>å‘é€è¿‡æ¥çš„æ•°æ®ï¼Œå¹¶ä¸”å½“<code>A</code>ç´¢è¦æ—¶å¯åŸæ ·è¿”å›ï¼Œå°±èƒ½ç”¨<code>B</code>æä¾›<code>A</code>çš„ç¼“å­˜éœ€æ±‚ã€‚æ— è®º<code>A</code>ç”¨ä»€ä¹ˆæ–¹å¼å»è®¿é—®<code>B</code>ï¼Œå®ƒä»¬ä¹‹é—´çš„è¿ä½œç€æ€æ ·çš„é€šä¿¡åè®®ï¼Œæ˜¯æœ¬åœ°è¿˜æ˜¯é€šè¿‡ç½‘ç»œã€‚ç”šè‡³<code>B</code>å¯ä»¥æ˜¯<code>A</code>çš„ä¸€éƒ¨åˆ†ï¼Œæˆ–è€…<code>A</code>å’Œ<code>B</code>éƒ½æ˜¯æŸä¸ªç³»ç»Ÿ<code>C</code>çš„ä¸€éƒ¨åˆ†ï¼Œ<code>A</code>å€ŸåŠ©äº†æŸäº›åŸºç¡€è®¾æ–½å¯¹<code>B</code>è¿›è¡Œäº†æ“ä½œï¼Œä¾‹å¦‚<code>B</code>æ˜¯æŸä¸ªå¯è¯»å†™å­˜å‚¨å™¨ã€å®ƒçš„é©±åŠ¨ç¨‹åºæˆ–è€…åœ¨å­˜å‚¨å™¨ä¸Šæ„é€ çš„å®¹å™¨ï¼ˆcontainerï¼‰æ•°æ®ç»“æ„å’Œç›¸å…³å¤„ç†æ–¹æ³•é›†åˆï¼Œå°±ç®—è¿™ä¸ªå­˜å‚¨å™¨æˆ–æ•°æ®ç»“æ„åœ¨æ•°æ®å†™å…¥åå°±ä¸å¯æ›´æ”¹ã€‚<br>ä¸€èˆ¬çš„ï¼Œå½“æˆ‘ä»¬åœ¨è¯´ç¼“å­˜æ—¶ï¼Œå…¶å®æ˜¯è¯´ï¼šä»¥ä»»æ„æ–¹å¼ï¼ŒæŠŠæ•°æ®å­˜å‚¨åœ¨å®¹å™¨ä¸­ï¼Œéœ€è¦çš„æ—¶å€™å°±ä»å®¹å™¨ä¸­è·å–ã€‚è™½ç„¶å¹¶ä¸è§„å®šä½¿ç”¨æ¬¡æ•°ï¼Œä½†åˆç†çš„ç­–ç•¥æ˜¯è‡³å°‘ä½¿ç”¨åˆ°1æ¬¡ï¼ŒğŸš« ä½¿ç”¨0æ¬¡çš„ä¸åº”ç¼“å­˜ã€‚<br>å®è´¨ä¸Šï¼Œç¼“å­˜å”¯ä¸€é—®é¢˜æ˜¯å­˜å‚¨å’Œè®¿é—®ï¼Œå…¶å®ƒé—®é¢˜éƒ½æ˜¯é™„åŠ çš„ã€‚æ‰§è¡Œä¸€æ¬¡æ“ä½œçš„ç»“æœè¢«åç»­å¤šæ¬¡ä½¿ç”¨éœ€æ±‚ï¼Œå°±æ˜¯ä¸šåŠ¡é—®é¢˜å¯¹ç¼“å­˜çš„é™„åŠ é—®é¢˜ï¼šæŠŠæŸä¸ªæ“ä½œçš„ç»“æœå­˜å‚¨èµ·æ¥ï¼Œåœ¨ä»¥åéœ€è¦ç”¨åˆ°æ—¶ç›´æ¥è¿”å›ç›¸åº”ç»“æœï¼Œè€Œä¸æ˜¯å†æ¬¡æ‰§è¡Œæ“ä½œç„¶åæŠŠç»“æœè¿”å›ã€‚ä½†ä¸€ä¸ªæ“ä½œï¼Œå®ƒå¯èƒ½ï¼šå¯è¿›ä¸€æ­¥ç»†åˆ†ï¼Œæ“ä½œçš„è¿‡ç¨‹ä¼šæ”¹å˜ä¸€äº›å¯¹è±¡çš„æ•°æ®ï¼Œå¤šæ¬¡æ‰§è¡Œçš„ç»“æœä¸åŒã€‚ç¼“å­˜åªæ˜¯æŠŠç»“æœå­˜å‚¨èµ·æ¥ï¼Œä½•æ—¶æ›´æ–°ã€ä½•æ—¶å¤±æ•ˆå–å†³äºç°å®è€ƒè™‘å’Œç¨‹åºå®ç°ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨ç¼“å­˜æ¥è‡ªåŠ¨å¤„ç†å…¶å®ƒé—®é¢˜ï¼Œåªè¦é™„åŠ ç›¸å…³çš„å¤„ç†é€»è¾‘å³å¯ã€‚</p>
</blockquote>
<blockquote>
<p><strong>NOTE</strong> è®¨è®ºä¸€ä¸ªç‰¹æ®Šæƒ…å½¢ï¼šå‡è®¾å‡½æ•°<code>fn</code>éœ€è¦å¼•ç”¨æŸä¸ªæ•°æ®ï¼Œå¹¶ä¸”å¸Œæœ›èƒ½åœ¨å¤šæ¬¡è°ƒç”¨é—´æŒç»­ã€‚é€šå¸¸çš„åšæ³•æ˜¯ï¼Œåœ¨ä¸€ä¸ªæ‰€å±çš„é«˜å±‚å‘½åç©ºé—´æˆ–ä½œç”¨åŸŸä¸­æœ‰åç§°ç»‘å®šäº†è¿™ä¸ªå¼•ç”¨æˆ–è€…è¿™ä¸ªåç§°æ‰€å¼•ç”¨çš„å®¹å™¨ç›´æ¥æˆ–é—´æ¥æŒæœ‰è¿™ä¸ªå¼•ç”¨ï¼Œç„¶ååœ¨æœ¬åœ°æ— å†²çªçš„ç­–ç•¥ä¸‹ï¼Œä½¿ç”¨åç§°å’Œå¦å¤–çš„é—´æ¥æ“ä½œå»è·å–è¿™ä¸ªå¼•ç”¨ã€‚ä½¿ç”¨åç§°å»è·å–ï¼Œå¹¶ä¸ä¿è¯æ¯æ¬¡è·å–çš„éƒ½æ˜¯åŒä¸€ä¸ªå¼•ç”¨ï¼Œä½†åœ¨è§„åˆ™çº¦æŸä¸‹ï¼Œå´æ˜¯å¯ä»¥åŠ ä»¥ä¿è¯ã€‚</p>
</blockquote>
<h3 id="1-å®šä¹‰åœ¨å‡½æ•°ä½“ä¸­"><a href="#1-å®šä¹‰åœ¨å‡½æ•°ä½“ä¸­" class="headerlink" title="1. å®šä¹‰åœ¨å‡½æ•°ä½“ä¸­"></a>1. å®šä¹‰åœ¨å‡½æ•°ä½“ä¸­</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">fn</span>():</span><br><span class="line">    val = <span class="string">&#x27;&lt;time-consuming&gt;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> val</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>NOTE</strong> å¦‚æœ<code>fn.__code__.co_consts</code>åŒ…å«è¿™é¡¹è®¡ç®—ç»“æœï¼ˆè§£é‡Šå™¨éšå«åœ°ç¼“å­˜äº†è¿™é¡¹å¸¸é‡ï¼‰ï¼Œé‚£ä¹ˆæ„å‘³ç€è¿™é¡¹è®¡ç®—åªåœ¨å‡½æ•°ç¼–è¯‘æ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œè¿™ä¸ªæ–¹æ¡ˆå°±æ˜¯å¯å–çš„</p>
<ol>
<li>æŸäº›å­—é¢é‡çš„ç®€å•è®¡ç®—</li>
<li>å‡½æ•°(<code>def</code>å’Œ<code>lambda</code>)å’Œç±»çš„å®šä¹‰ï¼ˆç¼“å­˜çš„æ˜¯codeå¯¹è±¡ï¼Œâš ï¸åœ¨å‡½æ•°å†…å®šä¹‰çš„ç±»ï¼Œç±»ä¼¼å‡½æ•°ï¼‰</li>
</ol>
</blockquote>
<blockquote>
<p>âš ï¸ ç¼“å­˜å¾€å¾€æŒ‡çš„æ˜¯ä¸€æ¬¡æ“ä½œçš„ç»“æœè¢«å¤šæ¬¡ä½¿ç”¨ï¼ŒæŠŠæ•°æ®ä¿å­˜åœ¨æŸä¸ªåç§°ä¸Šï¼Œç„¶ååœ¨éœ€è¦ä½¿ç”¨çš„æ—¶é—´å’Œåœ°ç‚¹ï¼Œä½¿ç”¨åç§°è¿›è¡Œè®¿é—®ï¼Œé‚£ä¹ˆå¹¿ä¹‰ä¸Šè®²ï¼Œä¿å­˜åœ¨åç§°ä¸Šçš„å€¼ï¼Œåœ¨å…¶ä½œç”¨èŒƒå›´å†…ï¼Œéƒ½æ˜¯ç¼“å­˜çš„(cached)ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">val = <span class="string">&#x27;&lt;expr&gt;&#x27;</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¤å¤„æ˜¯`val`æˆ–è€…æŸä¸ª`val`çš„å¼•ç”¨è€…çš„ä½œç”¨èŒƒå›´</span></span><br><span class="line"><span class="comment"># å¹¶åŒ…æ‹¬`val`ä½œä¸ºå‚æ•°ä¼ å…¥è¿™ä¸ªä½œç”¨èŒƒå›´çš„æƒ…å†µ</span></span><br><span class="line">use(val)</span><br></pre></td></tr></table></figure>
<p>âš ï¸ å‡½æ•°çš„åŸºæœ¬ä¿¡æ¯åœ¨ç¼–è¯‘æ—¶å°±ç¡®å®šï¼Œåœ¨æ‰§è¡Œæ—¶åˆå—åˆ°ä¼ å…¥å‚æ•°çš„å½±å“ã€‚æœ¬åœ°æœ‰å“ªäº›å˜é‡åï¼Œåœ¨ç¼–è¯‘æ—¶å°±ç¡®å®šï¼Œæ ¹æ®æ˜¾å¼çš„èµ‹å€¼è¯­å¥ï¼Œä»¥åŠå‡½æ•°å’Œç±»çš„å®šä¹‰è¯­å¥æ¥åˆ¤å®šã€‚å‡½æ•°ç¼–è¯‘æ˜¯ä¸€ä¸ªå¤šé˜¶æ®µçš„è¿‡ç¨‹ï¼Œå¦‚æœå‡½æ•°<code>b</code>çš„å®šä¹‰åµŒå¥—åœ¨å‡½æ•°<code>a</code>çš„å®šä¹‰å†…ï¼Œé‚£ä¹ˆåœ¨<code>a</code>çš„æœ¬åœ°å˜é‡åä¿¡æ¯æ”¶é›†å®Œæˆåï¼Œ<code>b</code>æ‰èƒ½è¢«ç¼–è¯‘ï¼Œä½†<code>b</code>çš„ç¼–è¯‘å®Œæˆæ—¶é—´ä¼šæ—©äº<code>a</code>ï¼Œ<code>b</code>çš„æŸäº›ä¸Šä¸‹æ–‡ä¿¡æ¯ä¹Ÿä¼šå–è‡ª<code>a</code>ï¼Œä¾‹å¦‚è‡ªç”±å˜é‡ã€‚<br>âš ï¸ æœ¬åœ°ä½œç”¨åŸŸä¸­å˜é‡çš„èµ‹å€¼ï¼ˆåŒ…æ‹¬å‡½æ•°å’Œç±»çš„å®šä¹‰ï¼‰æ˜¯ä¸€ä¸ªå¤æ‚æœºåˆ¶ï¼Œè¿œè¿œä¸æ˜¯ä¿®æ”¹æœ¬åœ°å‘½åç©ºé—´çš„åç§°å’Œå€¼çš„æ˜ å°„å…³ç³»é‚£ä¹ˆç®€å•ã€‚è¿™ç±»èµ‹å€¼ï¼Œä¼šå»ä¿®æ”¹å¤šä¸ªåœ°æ–¹ï¼Œæ ˆã€æœ¬åœ°å‘½åç©ºé—´ã€é—­åŒ…çš„è‡ªç”±å˜é‡å¯¹åº”<code>cell</code>å¯¹è±¡çš„<code>cell_contents</code>ç­‰ã€‚è¿™ç§å¤æ‚æ€§ä¹Ÿæ˜¯æœ‰æˆæœ¬çš„ï¼Œä¸»è¦å½±å“è¿è¡Œæ—¶çš„æ•ˆç‡ã€‚</p>
</blockquote>
<h3 id="2-å®šä¹‰åœ¨å‡½æ•°æ‰€åœ¨çš„å…¨å±€å‘½åç©ºé—´ä¸­"><a href="#2-å®šä¹‰åœ¨å‡½æ•°æ‰€åœ¨çš„å…¨å±€å‘½åç©ºé—´ä¸­" class="headerlink" title="2. å®šä¹‰åœ¨å‡½æ•°æ‰€åœ¨çš„å…¨å±€å‘½åç©ºé—´ä¸­"></a>2. å®šä¹‰åœ¨å‡½æ•°æ‰€åœ¨çš„å…¨å±€å‘½åç©ºé—´ä¸­</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">val = <span class="string">&#x27;&lt;time-consuming&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fn</span>():</span><br><span class="line">    <span class="keyword">return</span> val</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>NOTE</strong> è¿™æ„å‘³ç€ä¼šåœ¨å…¨å±€å‘½åç©ºé—´ä¸­å»ºç«‹ä¸€ä¸ªåç§°ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬ä¼šè®¤ä¸ºï¼Œè¿™æ˜¯å¯¹å…¨å±€å‘½åç©ºé—´çš„æ±¡æŸ“ï¼Œå°¤å…¶æ˜¯å½“è¿™ä¸ªåç§°åªè¢«æŸä¸€ä¸ªå‡½æ•°ç”¨åˆ°æ—¶ã€‚å‡½æ•°çš„<code>__globals__</code>å±æ€§å¼•ç”¨çš„å°±æ˜¯æ‰€åœ¨çš„å…¨å±€å‘½åç©ºé—´ï¼Œä¸è¿‡è¿™å¹¶ä¸æ„å‘³ç€è¿™ä¸ªå‘½åç©ºé—´ä¿ç•™ç€å¯¹å®ƒçš„å¼•ç”¨ã€‚å‡½æ•°çš„<code>__globals__</code>å±æ€§æ˜¯åªè¯»çš„ï¼Œä¸è¿‡<code>__code__</code>å±æ€§æ˜¯å¯æ›¿æ¢çš„ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªåŠŸèƒ½ç›¸åŒçš„æ–°å‡½æ•°ï¼Œå¼•ç”¨æŸä¸ª<code>dict</code>å¯¹è±¡ï¼Œå……å½“å®ƒçš„å…¨å±€å‘½åç©ºé—´ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Optional</span>, <span class="type">Type</span></span><br><span class="line"></span><br><span class="line">Function = <span class="type">Type</span>[<span class="built_in">type</span>(<span class="keyword">lambda</span>:<span class="literal">None</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">redirect_globals</span>(<span class="params"></span></span><br><span class="line"><span class="params">    namespace: <span class="built_in">dict</span>,</span></span><br><span class="line"><span class="params">    fn: <span class="type">Optional</span>[Function] = <span class="literal">None</span></span></span><br><span class="line"><span class="params"></span>) -&gt; Function:</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    åˆ©ç”¨ä¼ å…¥çš„å‘½åç©ºé—´`namespace`å’Œå‡½æ•°`fn`ï¼Œåˆ›å»ºä¸€ä¸ªå’Œ`fn`åŠŸèƒ½å’Œç­¾åå®Œå…¨ç›¸åŒçš„å‡½æ•°ï¼Œ</span></span><br><span class="line"><span class="string">    ä½†æ˜¯__globals__å±æ€§ä¸º`namespace`çš„å‡½æ•°ï¼Œè¦æ±‚`fn.__closure__`æ²¡æœ‰è¢«è®¾ç½®</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param namespace: ä½œä¸ºæ–°å‡½æ•°çš„å…¨å±€å‘½åç©ºé—´</span></span><br><span class="line"><span class="string">    :param fn: å‡½æ•°</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :return: å’Œ`fn`åŠŸèƒ½å’Œç­¾åå®Œå…¨ç›¸åŒï¼Œä½†å…¨å±€å‘½åç©ºé—´ä¸º`namespace`çš„å‡½æ•°</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> fn <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> functools.partial(redirect_globals, namespace)</span><br><span class="line">    f = <span class="built_in">eval</span>(<span class="string">&#x27;lambda: None&#x27;</span>, namespace)</span><br><span class="line">    <span class="comment"># `fn`çš„è‡ªç”±å˜é‡ä¸ªæ•°ä¸ä¸º0æ—¶ï¼Œä¼šæŠ›å‡º`ValueError`ï¼Œæ„å‘³ç€å®ƒå…¶å®æ˜¯ä¸€ä¸ªé—­åŒ…</span></span><br><span class="line">    <span class="comment"># å¯æ ¹æ®`fn.__closure__`æˆ–`fn.__code__.co_freevars`åˆ¤æ–­</span></span><br><span class="line">    f.__code__ = fn.__code__</span><br><span class="line">    <span class="keyword">return</span> functools.update_wrapper(f, fn)</span><br></pre></td></tr></table></figure>

<h3 id="3-åœ¨å‡½æ•°çš„å®šä¹‰å¤´ä¸­å®šä¹‰é»˜è®¤å‚æ•°"><a href="#3-åœ¨å‡½æ•°çš„å®šä¹‰å¤´ä¸­å®šä¹‰é»˜è®¤å‚æ•°" class="headerlink" title="3. åœ¨å‡½æ•°çš„å®šä¹‰å¤´ä¸­å®šä¹‰é»˜è®¤å‚æ•°"></a>3. åœ¨å‡½æ•°çš„å®šä¹‰å¤´ä¸­å®šä¹‰é»˜è®¤å‚æ•°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">fn</span>(<span class="params">val=<span class="string">&#x27;&lt;time-consuming&gt;&#x27;</span></span>):</span><br><span class="line">    <span class="keyword">return</span> val</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>NOTE</strong> åœ¨å®šä¹‰å¤´ä¸­å®šä¹‰ï¼Œåªåœ¨å‡½æ•°ç¼–è¯‘æ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œå…è®¸æ˜¯ä»»ä½•è¡¨è¾¾å¼ï¼Œæ— è®ºå®ƒæœ‰å¤šå¤æ‚ã€‚ä¸è¿‡è¿™ç§åšæ³•ä¹Ÿä¼šè¢«è®¤ä¸ºæ±¡æŸ“äº†å‡½æ•°çš„ç­¾åï¼Œå¯¹ä½¿ç”¨è€…é€ æˆå›°æƒ‘ï¼Œå³ä¾¿å‚æ•°åä»¥ä¸‹åˆ’çº¿å¼€å¤´ã€‚</p>
</blockquote>
<blockquote>
<p><strong>NOTE</strong> åœ¨å‡½æ•°å¤´ä¸­å®šä¹‰é»˜è®¤å‚æ•°ï¼Œè‡ªåŠ¨è®¾ç½®äº†å®ƒçš„<code>__defaults__</code>å’Œ<code>__kwdefaults__</code>çš„å±æ€§ï¼Œå®ƒä»¬éƒ½æ˜¯å¯æ›¿æ¢çš„ï¼Œè€Œä¸”<code>__kwdefaults__</code>æ˜¯ä¸€ä¸ªæ™®é€šçš„å­—å…¸ï¼Œæœ¬èº«å°±æ˜¯å¯æ”¹çš„ã€‚åœ¨å‡½æ•°è°ƒç”¨æ—¶ï¼Œæ–°ä¼ å…¥çš„å‚æ•°ä¼šé®ç›–è¿™äº›é»˜è®¤å‚æ•°ï¼Œå…·ä½“è¡Œä¸ºå¦‚ä¸‹ï¼š</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">fn</span>(<span class="params">foo=<span class="number">1</span>, bar=<span class="number">2</span>, *, baz=<span class="string">&#x27;0&#x27;</span></span>): <span class="keyword">return</span> foo, bar, baz</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fn.__defaults__</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fn.__kwdefaults__</span><br><span class="line">&#123;<span class="string">&#x27;baz&#x27;</span>: <span class="string">&#x27;0&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fn.__defaults__ = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fn.__defaults__[<span class="string">&#x27;baz&#x27;</span>] = <span class="string">&#x27;inf&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fn()</span><br><span class="line">(<span class="number">2</span>, <span class="number">3</span>, <span class="string">&#x27;inf&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fn(<span class="number">1</span>, <span class="number">2</span>, baz=<span class="number">3</span>)</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fn.__defaults__ = (<span class="number">0</span>,)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fn()</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: fn() missing <span class="number">1</span> required positional argument: <span class="string">&#x27;foo&#x27;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>âœ åœ¨å®šä¹‰å¤´ä¸Šçš„å‚æ•°åç§°ï¼Œæ˜¯å‡½æ•°æœ¬åœ°çš„ï¼Œä¼šè®¡å…¥<code>fn.__code__.co_nlocals</code>å’Œ<code>fn.__code__.co_varnames</code>ä¸­ï¼Œä½†ä¸ä¼šè®¡å…¥<code>fn.__code__.co_consts</code>ä¸­ã€‚ä½ç½®å‚æ•°è®¡å…¥<code>fn.__code__.co_argcount</code>ï¼Œä½†å¯å˜é•¿åº¦å‚æ•°ä¸è®¡å…¥ï¼Œä¾‹å¦‚<code>*args</code>ã€‚<code>__defaults__</code>å’Œ<code>__kwdefaults__</code>éƒ½æ˜¯å®¹å™¨ï¼Œè¿™æ˜¯è§£é‡Šå™¨çš„è‡ªåŠ¨ç¼“å­˜ç­–ç•¥ï¼Œç¼–è¯‘å‡½æ•°é™¤äº†ç”Ÿæˆæœºå™¨ï¼ˆä¾‹å¦‚<kbd>PVM</kbd>ï¼‰çš„å­—èŠ‚ç ï¼Œè¿˜æœ‰æ”¶é›†ä¸Šä¸‹æ–‡ç›¸å…³ä¿¡æ¯ç»‘å®šåˆ°å‡½æ•°å¯¹è±¡çš„è¿‡ç¨‹ã€‚</p>
</blockquote>
<h3 id="4-é—­åŒ…"><a href="#4-é—­åŒ…" class="headerlink" title="4. é—­åŒ…"></a>4. é—­åŒ…</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">outer</span>():</span><br><span class="line">    val = <span class="string">&#x27;&lt;time-consuming&gt;&#x27;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">fn</span>():</span><br><span class="line">        <span class="keyword">return</span> val</span><br><span class="line">    <span class="keyword">return</span> fn</span><br><span class="line"></span><br><span class="line">fn = outer()</span><br><span class="line"><span class="comment"># del outer</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>NOTE</strong> å¦‚æœä½¿ç”¨é—­åŒ…å­˜ç²¹æ˜¯ä¸ºäº†ä¸æ±¡æŸ“å…¨å±€å‘½åç©ºé—´ï¼Œé‚£ä¹ˆå¤–å±‚å‡½æ•°ä½¿ç”¨ä¸€æ¬¡ï¼ŒæŠŠå®ƒçš„è¿”å›å€¼ç»‘å®šåˆ°ä¸€ä¸ªå˜é‡åï¼Œå°±å¯ä»¥åˆ é™¤äº†ã€‚åœ¨<kbd>Python</kbd>ä¸­ï¼Œä½¿ç”¨<code>def</code>(ä¹ŸåŒ…æ‹¬<code>async def</code>ç­‰<code>def</code>è¡ç”Ÿ)å®šä¹‰å‡½æ•°çš„æ„é€ è¢«è®¤ä¸ºæ˜¯è¯­å¥è€Œéè¡¨è¾¾å¼ï¼Œç”¨<code>lambda</code>å®šä¹‰å‡½æ•°çš„æ„é€ è™½ç„¶æ˜¯è¡¨è¾¾å¼ï¼Œä½†æ˜¯å®šä¹‰ä½“ä¸­åªå…è®¸ç”¨ä¸”åªç”¨1ä¸ªè¡¨è¾¾å¼ï¼Œè¿ç”¨è¿™ç§æŠ€æœ¯å°±å¿…é¡»å†™ä¸€äº›<strong>å†—ä½™</strong>çš„ä»£ç ã€‚<kbd>JavaScript</kbd>çš„ç”¨æˆ·ç¬‘äº†ğŸ˜„ï¼Œå› ä¸º<kbd>JavaScript</kbd>ä¸­å‡ ä¹æ‰€æœ‰ç»“æ„éƒ½æ˜¯è¡¨è¾¾å¼ï¼Œæ„å‘³ç€æœ‰è¿”å›å€¼ï¼Œè¿™ç§æ€§è´¨å¯è°“awesomeã€‚</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fn = (<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    val = <span class="string">&#x27;&lt;time-consuming&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> val;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Pythonçš„å‡½æ•°ï¼Œä¹Ÿæœ‰ä¸€ä¸ªè®¾è®¡é—®é¢˜ï¼Œå°±æ˜¯å®ƒä»¬çš„<code>__closure__</code>å±æ€§æ˜¯åªè¯»çš„ã€‚è¿™å¯ä»¥ç†è§£ï¼Œå› ä¸º<code>__closure__</code>å®é™…ä¸Šå’Œ<code>__code__.co_freevars</code>å­˜åœ¨å…³ç³»ï¼Œå³ä¾¿å‡½æ•°çš„<code>__code__</code>å±æ€§å¯è¢«æ›¿æ¢ï¼Œä½†ä¹Ÿè¦å’Œ<code>__closure__</code>å±æ€§åè°ƒï¼Œå³å¹¶éæ‰€æœ‰çš„æ›¿æ¢éƒ½èƒ½è¢«æ¥å—ã€‚å¦‚æœæƒ³æ„é€ ä¸€ä¸ªåªæ˜¯<code>__closure__</code>å±æ€§ä¸åŒï¼ŒåŠŸèƒ½ç›¸åŒçš„å‡½æ•°ï¼Œå…¶å®æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"><span class="keyword">import</span> inspect</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Optional</span>, <span class="type">Type</span>, Mapping</span><br><span class="line"></span><br><span class="line">Function = <span class="type">Type</span>[<span class="built_in">type</span>(<span class="keyword">lambda</span>:<span class="literal">None</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">use_closure</span>(<span class="params"></span></span><br><span class="line"><span class="params">    namespace: Mapping,</span></span><br><span class="line"><span class="params">    fn: <span class="type">Optional</span>[Function] = <span class="literal">None</span></span></span><br><span class="line"><span class="params"></span>) -&gt; Function:</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    åˆ©ç”¨ä¼ å…¥çš„å‘½åç©ºé—´`namespace`å’Œå‡½æ•°`fn`ï¼Œåˆ›å»ºä¸€ä¸ªå’Œ`fn`åŠŸèƒ½å’Œç­¾åå®Œå…¨ç›¸åŒçš„å‡½æ•°ï¼Œ</span></span><br><span class="line"><span class="string">    ä½†æ˜¯__closure__å±æ€§å¯èƒ½æœ‰æ‰€ä¸åŒçš„å‡½æ•°</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param namespace: `fn`ä¸­çš„éæœ¬åœ°å˜é‡ä¼šå°è¯•ä»è¿™ä¸ªæ˜ å°„ä¸­æå–</span></span><br><span class="line"><span class="string">    :param fn: å‡½æ•°</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :return: å’Œ`fn`åŠŸèƒ½å’Œç­¾åå®Œå…¨ç›¸åŒï¼Œä½†å°è¯•ä»`namespace`è·å–ä¸€äº›å€¼æ¥æ„å»º__closure__</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> fn <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> functools.partial(use_closure, mapping)</span><br><span class="line">    assign = <span class="string">&#x27;\n    &#x27;</span>.join(<span class="built_in">map</span>(<span class="string">&#x27;&#123;0&#125; = __[&quot;&#123;0&#125;&quot;]&#x27;</span>.<span class="built_in">format</span>, mapping))</span><br><span class="line">    <span class="comment"># è·å–çš„æºä»£ç ï¼Œå¯èƒ½æ˜¯ä¸å¯ç”¨çš„ï¼Œæˆ–è€…å¯èƒ½è·å–ä¸åˆ°ï¼Œå¯¹äºlambdaå‡½æ•°ï¼Œè¿™æ ·çš„å¤„ç†ä¹Ÿæ˜¯ä¸é€‚åˆçš„</span></span><br><span class="line">    source = <span class="string">&#x27;    &#x27;</span>.join(inspect.getsourcelines(fn)[<span class="number">0</span>])</span><br><span class="line">    <span class="built_in">exec</span>(<span class="string">f&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">def outer(__):</span></span><br><span class="line"><span class="string">    <span class="subst">&#123;assign&#125;</span></span></span><br><span class="line"><span class="string">    <span class="subst">&#123;source&#125;</span></span></span><br><span class="line"><span class="string">    return <span class="subst">&#123;fn.__name__&#125;</span></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>, fn.__globals__, <span class="built_in">locals</span>())</span><br><span class="line">    <span class="keyword">return</span> functools.update_wrapper(<span class="built_in">locals</span>()[<span class="string">&#x27;outer&#x27;</span>](mapping), fn)</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>NOTE</strong> è™½ç„¶å‡½æ•°çš„<code>__closure__</code>å±æ€§ä¸å¯æ›´æ”¹ï¼Œä½†æ˜¯<code>__closure__</code>ä¸­æ‰€æœ‰<code>cell</code>å¯¹è±¡çš„<code>cell_contents</code>æ˜¯å¯æ›´æ”¹çš„ã€‚å®Œå…¨å¯ä»¥ç²¾å¿ƒè®¾è®¡å‡½æ•°å®šä¹‰ï¼Œå…ˆå ç”¨å‡ ä¸ª<code>__closure__</code>ä½ç½®ï¼Œåœ¨ä»¥åéœ€è¦çš„æ—¶å€™è¿›è¡Œæ›´æ”¹ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">outer</span>():</span><br><span class="line">    val: <span class="built_in">int</span> = <span class="number">1</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner</span>():</span><br><span class="line">        <span class="keyword">return</span> val</span><br><span class="line">    <span class="keyword">return</span> inner</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>fn = outer()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fn.__closure__</span><br><span class="line">(&lt;cell at <span class="number">0x10e375d68</span>: <span class="built_in">int</span> <span class="built_in">object</span> at <span class="number">0x10e0105a0</span>&gt;,)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fn.__closure__[<span class="number">0</span>].cell_contents = <span class="string">&#x27;foo&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fn.__closure__</span><br><span class="line">(&lt;cell at <span class="number">0x10e375d68</span>: <span class="built_in">str</span> <span class="built_in">object</span> at <span class="number">0x10e3dd180</span>&gt;,)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fn()</span><br><span class="line"><span class="string">&#x27;foo&#x27;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>âœ ä½†æˆ‘å»ºè®®ä¸€ç§æ›´ä¸ºé›†ä¸­çš„ç®¡ç†åŠæ³•ï¼ŒæŠŠæ•°æ®ä¿å­˜åˆ°æ˜ å°„å®¹å™¨é‡Œé¢ï¼Œæ¨è<code>dict</code></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">outer</span>():</span><br><span class="line">    _closure_ns: <span class="built_in">dict</span> = &#123;&#125;</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner</span>():</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;val&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> _closure_ns:</span><br><span class="line">            _closure_ns[<span class="string">&#x27;val&#x27;</span>] = <span class="string">&#x27;&lt;time-consuming&gt;&#x27;</span></span><br><span class="line">        val = _closure_ns[<span class="string">&#x27;val&#x27;</span>]</span><br><span class="line">        <span class="keyword">return</span> i</span><br><span class="line">    <span class="keyword">return</span> inner</span><br></pre></td></tr></table></figure>

<h3 id="5-nonlocalå’Œglobal"><a href="#5-nonlocalå’Œglobal" class="headerlink" title="5. nonlocalå’Œglobal"></a>5. nonlocalå’Œglobal</h3><blockquote>
<p><strong>NOTE</strong> <code>nonlocal</code>ç”¨äºå£°æ˜æŸä¸ªåç§°æ˜¯è‡ªç”±å˜é‡ï¼ˆéæœ¬åœ°å’Œæ¨¡å—å±‚æ¬¡ï¼Œå±äºé—­åŒ…å±‚æ¬¡ä½œç”¨åŸŸï¼‰ï¼Œè€Œ<code>global</code>ç”¨äºå£°æ˜æŸä¸ªåç§°æ˜¯å…¨å±€å˜é‡ï¼ˆ<code>globals()</code>ï¼Œæ¨¡å—å±‚æ¬¡ä½œç”¨åŸŸï¼‰ã€‚å½“ä¸€ä¸ªå‡½æ•°è°ƒç”¨ç»“æŸåï¼Œåœ¨æœ¬åœ°ä½œç”¨åŸŸå»ºç«‹çš„æ‰€æœ‰åç§°éƒ½ä¼šè¢«é”€æ¯ï¼ˆä½“ç°ä¸ºå®ƒä»¬æ‰€å¼•ç”¨å¯¹è±¡çš„å¼•ç”¨è®¡æ•°è‡ªåŠ¨å‡å°ç›¸åº”æ•°ç›®ï¼‰ï¼ŒåŒ…æ‹¬ï¼š</p>
<blockquote>
<ol>
<li>æœ¬åœ°èµ‹å€¼çš„åç§°</li>
<li>å®šä¹‰å¤´ä¸­çš„åç§°</li>
<li><code>nonlocal</code>å’Œ<code>global</code>å£°æ˜çš„åç§°</li>
</ol>
</blockquote>
<p><kbd>2.</kbd>ä¸­çš„é»˜è®¤å‚æ•°å’Œ<kbd>3.</kbd>éƒ½æœ‰è‡ªåŠ¨ç¼“å­˜ï¼Œä½†æ¯æ¬¡æ‰§è¡Œæ—¶éƒ½éœ€è¦æ‹¿ç¼“å­˜æ‰§è¡Œèµ‹å€¼ï¼Œå¹¶ä¸ç­‰åŒäºä¼ ç»Ÿè¯­è¨€çš„é™æ€å˜é‡ã€‚å½“åœ¨æœ¬åœ°ç”¨èµ‹å€¼è¯­å¥ä¿®æ”¹è‡ªç”±å˜é‡çš„å€¼æ—¶ï¼Œä¼šè‡ªåŠ¨æ›´æ–°å‡½æ•°çš„<code>__closure__</code>ä¸­ç›¸åº”<code>cell</code>å¯¹è±¡çš„<code>cell_content</code>çš„å€¼ï¼Œä¿®æ”¹å…¨å±€å˜é‡åˆ™æ—¶æ›´æ–°å¯¹åº”çš„æ¨¡å—å±‚æ¬¡å‘½åç©ºé—´<code>globals()</code>ä¸­çš„åç§°å’Œå€¼çš„æ˜ å°„å…³ç³»ã€‚</p>
</blockquote>
<h3 id="6-å®¹å™¨"><a href="#6-å®¹å™¨" class="headerlink" title="6. å®¹å™¨"></a>6. å®¹å™¨</h3><blockquote>
<p><strong>NOTE</strong> å®¹å™¨åŒ…æ‹¬ä½œç”¨åŸŸã€å‘½åç©ºé—´ã€ç‰©ç†å­˜å‚¨åŒºåŸŸåœ¨é€»è¾‘ä¸Šçš„ç®¡ç†æœºåˆ¶ç­‰ã€‚ç¼“å­˜åªæ˜¯å®¹å™¨çš„è¿ç”¨ä¹‹ä¸€ï¼Œå®¹å™¨ä¸»è¦çš„åŠŸèƒ½åœ¨äºå®ç°ç¨‹åºçš„åŠ¨æ€å’Œæ•°æ®çš„é›†ä¸­ï¼ˆæ›´ä¸€èˆ¬çš„è¯´ï¼Œæ•°æ®ç»“æ„å®ç°äº†æ•°æ®çš„ç§©åºï¼Œå®¹å™¨æ˜¯ä¸€ç±»æ•°æ®ç»“æ„ï¼‰ã€‚</p>
</blockquote>
<blockquote>
<p><strong>NOTE</strong> åœ¨å‡½æ•°çš„å¤šæ¬¡è°ƒç”¨é—´æŒç»­å¼•ç”¨éœ€åˆ©ç”¨<strong>éæœ¬åœ°çš„å®¹å™¨</strong>ç¼“å­˜ï¼š</p>
<ol>
<li>å­˜å‚¨äºæ¯”å‡½æ•°æœ¬åœ°çš„æ›´é«˜å±‚çš„ä½œç”¨åŸŸæˆ–å‘½åç©ºé—´è€…å‡½æ•°çš„é»˜è®¤å‚æ•°ä¸­ï¼Œä¸€ä¸ª<kbd>Python</kbd>å‡½æ•°ä¼šè‡ªåŠ¨å¯»æ‰¾æœªåœ¨æœ¬åœ°å£°æ˜è€Œéœ€è¦ç”¨åˆ°çš„åç§°ï¼›</li>
<li>æˆ–è€…å­˜å‚¨äºä¸Šè¿°éæœ¬åœ°åç§°æ‰€å¼•ç”¨çš„å®¹å™¨ä¸­ã€‚</li>
</ol>
</blockquote>
<blockquote>
<p>âœ å¦‚æœæŠŠç¼“å­˜çš„ä½¿ç”¨å°è£…åˆ°ä¸€æ¡æŒ‡ä»¤ä¸­ï¼Œä¾‹å¦‚å‡½æ•°ï¼Œå®ƒä»¥ä¸Šè¿°æ–¹å¼å¼•ç”¨äº†ä¸€ä¸ªå¤–éƒ¨å®¹å™¨ï¼Œç”±æ­¤å¯å®ç°æƒ°æ€§è®¡ç®—å’Œç¼“å­˜ã€‚å¯¹äºçº¯å‡½æ•°ï¼Œç›¸åŒçš„å‚æ•°ä¼ å…¥è¿”å›ç›¸åŒçš„ç»“æœï¼Œé‚£ä¹ˆæŠŠå…·ä½“å‚æ•°å’Œç›¸åº”è¿”å›å€¼å»ºç«‹å…³è”ï¼Œå­˜å…¥ä¸€ä¸ªæ˜ å°„å‹å®¹å™¨ä¸­ï¼Œé‚£ä¹ˆæ¯ä¸ªä¸åŒçš„å‚æ•°ä¼ å…¥åªéœ€è¦è®¡ç®—ä¸€æ¬¡ã€‚<br>å¦‚æœè®©å‡½æ•°è‡ªåŠ¨ç»´æŠ¤ç¼“å­˜ï¼Œéœ€è¦å¢åŠ å¯¹å®¹å™¨çš„æŸ¥è¯¢å’Œå†™å…¥çš„æ“ä½œï¼ŒæŸ¥è¯¢æ˜¯æ¯æ¬¡æ‰§è¡Œï¼Œå†™å…¥æ‰§è¡Œä¸€æ¬¡ï¼ˆè‹¥æœ‰ç¼“å­˜åˆ é™¤åˆ™æ¬¡æ•°å–å†³äºç®—æ³•å’Œå®é™…æƒ…å†µï¼‰ï¼Œè¿™ä¹Ÿæ˜¯æœ‰æˆæœ¬çš„ï¼Œéœ€è¦å’Œè®¡ç®—çš„æˆæœ¬è¿›è¡Œæƒè¡¡å–èˆã€‚<br><code>functools.lru_cache</code>å®ç°äº† Least Recently Used ç®—æ³•çš„ç¼“å­˜ç®¡ç†ï¼Œç¼“å­˜å¹¶éä¸€ç›´æœ‰æ•ˆï¼Œå½“é•¿æ—¶é—´ä¸ç”¨çš„ç¼“å­˜å°†ä¼šè¢«æ¸…ç†ã€‚è¿™ä¸æ˜¯å”¯ä¸€çš„ç¼“å­˜ç®¡ç†ç®—æ³•ï¼Œä¾‹å¦‚ä½ è¿˜å¯ä»¥ä½¿ç”¨ LFU(Least Frequently Used) ç­‰ç®—æ³•ã€‚</p>
</blockquote>
<blockquote>
<p>âœ å‘½åç©ºé—´ï¼ˆnamespaceï¼‰å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ˜ å°„å‹çš„æ•°æ®ç»“æ„ï¼Œå°¤å…¶æ˜¯æ•£åˆ—è¡¨ï¼Œè¢«å¹¿æ³›ç”¨äºå……å½“å‘½åç©ºé—´ã€‚æ‰€è°“åç§°å®šä¹‰åœ¨æŸä¸ªå‘½åç©ºé—´ï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨å‘½åç©ºé—´æœ‰è¿™ä¸ªåç§°çš„åç§°-å€¼å¯¹ï¼Œè®¿é—®æŸä¸ªå‘½åç©ºé—´ä¸­çš„æŸä¸ªåç§°ï¼Œå°±æ˜¯åœ¨è¿™ä¸ªå‘½åç©ºé—´ä¸­è¿™ä¸ªåç§°çš„åç§°-å€¼å¯¹ä¸­çš„å€¼ã€‚<br>é€šè¿‡åç§°ï¼Œè®¿é—®ä½œç”¨åŸŸæˆ–å‘½åç©ºé—´è¿™ç±»å®¹å™¨ä¸­çš„å€¼ï¼Œåªèƒ½ç¡®ä¿åç§°æ˜¯ç¡®å®šçš„ï¼Œè€Œå€¼è¦å–å¾—åæ‰èƒ½ç¡®å®šï¼Œæˆ–è€…è¯´ï¼Œå¦‚æœå€¼å‘ç”Ÿå˜æ›´é‚£ä¹ˆå–å¾—å€¼ä¹Ÿæ˜¯ä¸åŒçš„ï¼Œè¿™è®©æƒ…å†µå˜å¾—ç›¸å½“çµæ´»å’Œå¤æ‚å¤šå˜ã€‚</p>
</blockquote>
</div><div class="article-licensing box"><div class="licensing-title"><p>CPythonä¸­å‡½æ•°çš„éæœ¬åœ°å˜é‡</p><p><a href="https://chenyanggao.github.io/2019/04/30/2.CPythonä¸­å‡½æ•°çš„éæœ¬åœ°å˜é‡/">https://chenyanggao.github.io/2019/04/30/2.CPythonä¸­å‡½æ•°çš„éæœ¬åœ°å˜é‡/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>ä½œè€…</h6><p>ChenyangGao</p></div></div><div class="level-item is-narrow"><div><h6>å‘å¸ƒäº</h6><p>2019-04-30</p></div></div><div class="level-item is-narrow"><div><h6>æ›´æ–°äº</h6><p>2025-08-20</p></div></div><div class="level-item is-narrow"><div><h6>è®¸å¯åè®®</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Python/">Python</a></div><!--!--></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Ÿæ‰“èµä¸€ä¸‹ä½œè€…å§</h3><div class="buttons is-centered"><a class="button donate" href="/" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>é€æˆ‘æ¯å’–å•¡</span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2019/05/28/3.%E5%88%A9%E7%94%A8%E5%BC%82%E5%B8%B8%E5%AE%9E%E7%8E%B0%E8%B6%8A%E7%BA%A7return%EF%BC%88Python%E5%AE%9E%E7%8E%B0%EF%BC%89/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">åˆ©ç”¨å¼‚å¸¸å®ç°è¶Šçº§returnï¼ˆPythonå®ç°ï¼‰</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2019/04/28/1.%E6%A0%87%E5%87%86%E5%BC%8F%E5%8D%9A%E5%BC%88/"><span class="level-item">æ ‡å‡†å¼åšå¼ˆ</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://octodex.github.com/images/hula_loop_octodex03.gif" alt="ChenyangGao"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">ChenyangGao</p><p class="is-size-6 is-block">Thinker</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ–‡ç« </p><a href="/archives/"><p class="title">15</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">åˆ†ç±»</p><a href="/categories/"><p class="title">6</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ ‡ç­¾</p><a href="/tags/"><p class="title">5</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/ChenyangGao" target="_blank" rel="me noopener">å…³æ³¨æˆ‘</a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">é“¾æ¥</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile" href="https://bulma.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bulma</span></span><span class="level-right"><span class="level-item tag">bulma.io</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">åˆ†ç±»</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/%E6%95%B0%E5%AD%A6/"><span class="level-start"><span class="level-item">æ•°å­¦</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E6%95%B0%E5%AD%A6/%E7%BB%8F%E6%B5%8E%E5%AD%A6/"><span class="level-start"><span class="level-item">ç»æµå­¦</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E7%AE%80%E5%8D%95%E8%84%9A%E6%9C%AC/"><span class="level-start"><span class="level-item">ç®€å•è„šæœ¬</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3/"><span class="level-start"><span class="level-item">ç¼–ç¨‹æ€æƒ³</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/%E8%84%9A%E6%9C%AC%E5%B7%A5%E5%85%B7/"><span class="level-start"><span class="level-item">è„šæœ¬å·¥å…·</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/%E9%80%9A%E7%94%A8%E6%A8%A1%E5%9D%97/"><span class="level-start"><span class="level-item">é€šç”¨æ¨¡å—</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">æ ‡ç­¾</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Module/"><span class="tag">Module</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python/"><span class="tag">Python</span><span class="tag">12</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Script/"><span class="tag">Script</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Shell/"><span class="tag">Shell</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8D%9A%E5%BC%88%E8%AE%BA/"><span class="tag">åšå¼ˆè®º</span><span class="tag">1</span></a></div></div></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">æœ€æ–°æ–‡ç« </h3><article class="media"><figure class="media-left"><a class="image" href="/2025/08/20/15.python%E7%9A%84%E5%AD%97%E5%85%B8%E5%92%8C%E9%9B%86%E5%90%88%E7%9A%84%E9%80%80%E5%8C%96/"><img src="https://cdn.pixabay.com/photo/2018/09/28/03/33/python-3708448_1280.jpg" alt="pythonçš„å­—å…¸å’Œé›†åˆçš„é€€åŒ–"></a></figure><div class="media-content"><p class="date"><time dateTime="2025-08-20T08:00:00.000Z">2025-08-20</time></p><p class="title"><a href="/2025/08/20/15.python%E7%9A%84%E5%AD%97%E5%85%B8%E5%92%8C%E9%9B%86%E5%90%88%E7%9A%84%E9%80%80%E5%8C%96/">pythonçš„å­—å…¸å’Œé›†åˆçš„é€€åŒ–</a></p><p class="categories"><a href="/categories/%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3/">ç¼–ç¨‹æ€æƒ³</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2023/08/02/14.%E5%9C%A8Linux:MacOSX%E4%B8%8A%E9%83%A8%E7%BD%B2AList%E5%92%8Cclouddrive/"><img src="https://cdn.pixabay.com/photo/2015/08/21/00/21/library-898333_1280.jpg" alt="åœ¨Linux/MacOSXä¸Šéƒ¨ç½²AListå’Œclouddrive"></a></figure><div class="media-content"><p class="date"><time dateTime="2023-08-02T08:00:00.000Z">2023-08-02</time></p><p class="title"><a href="/2023/08/02/14.%E5%9C%A8Linux:MacOSX%E4%B8%8A%E9%83%A8%E7%BD%B2AList%E5%92%8Cclouddrive/">åœ¨Linux/MacOSXä¸Šéƒ¨ç½²AListå’Œclouddrive</a></p><p class="categories"><a href="/categories/%E7%AE%80%E5%8D%95%E8%84%9A%E6%9C%AC/">ç®€å•è„šæœ¬</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2022/09/08/13.Python%E6%A8%A1%E5%9D%97-pandas.DataFrame%E8%BD%ACExcel%E6%A0%BC%E5%BC%8F%E7%9A%84bytes%E6%95%B0%E6%8D%AE/"><img src="https://cdn.pixabay.com/photo/2013/12/10/18/22/green-tree-python-226553_1280.jpg" alt="Pythonæ¨¡å—-pandas.DataFrameè½¬Excelæ ¼å¼çš„bytesæ•°æ®"></a></figure><div class="media-content"><p class="date"><time dateTime="2022-09-08T10:00:00.000Z">2022-09-08</time></p><p class="title"><a href="/2022/09/08/13.Python%E6%A8%A1%E5%9D%97-pandas.DataFrame%E8%BD%ACExcel%E6%A0%BC%E5%BC%8F%E7%9A%84bytes%E6%95%B0%E6%8D%AE/">Pythonæ¨¡å—-pandas.DataFrameè½¬Excelæ ¼å¼çš„bytesæ•°æ®</a></p><p class="categories"><a href="/categories/%E9%80%9A%E7%94%A8%E6%A8%A1%E5%9D%97/">é€šç”¨æ¨¡å—</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2022/09/01/12.Python%E6%A8%A1%E5%9D%97-%E6%89%93%E5%8C%85%E5%A4%9A%E4%B8%AA%E5%8F%82%E6%95%B0%E4%BA%8E%E4%B8%80%E4%BD%93/"><img src="https://cdn.pixabay.com/photo/2014/12/11/22/10/python-564817_1280.jpg" alt="Pythonæ¨¡å—-æ‰“åŒ…å¤šä¸ªå‚æ•°äºä¸€ä½“"></a></figure><div class="media-content"><p class="date"><time dateTime="2022-09-01T08:00:00.000Z">2022-09-01</time></p><p class="title"><a href="/2022/09/01/12.Python%E6%A8%A1%E5%9D%97-%E6%89%93%E5%8C%85%E5%A4%9A%E4%B8%AA%E5%8F%82%E6%95%B0%E4%BA%8E%E4%B8%80%E4%BD%93/">Pythonæ¨¡å—-æ‰“åŒ…å¤šä¸ªå‚æ•°äºä¸€ä½“</a></p><p class="categories"><a href="/categories/%E9%80%9A%E7%94%A8%E6%A8%A1%E5%9D%97/">é€šç”¨æ¨¡å—</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2022/08/30/11.Python%E8%84%9A%E6%9C%AC%E8%AE%BE%E7%BD%AEpip%E7%B4%A2%E5%BC%95%E6%BA%90/"><img src="https://cdn.pixabay.com/photo/2016/02/27/10/26/snake-1225370_1280.jpg" alt="Pythonè„šæœ¬è®¾ç½®pipç´¢å¼•æº"></a></figure><div class="media-content"><p class="date"><time dateTime="2022-08-30T07:00:00.000Z">2022-08-30</time></p><p class="title"><a href="/2022/08/30/11.Python%E8%84%9A%E6%9C%AC%E8%AE%BE%E7%BD%AEpip%E7%B4%A2%E5%BC%95%E6%BA%90/">Pythonè„šæœ¬è®¾ç½®pipç´¢å¼•æº</a></p><p class="categories"><a href="/categories/%E8%84%9A%E6%9C%AC%E5%B7%A5%E5%85%B7/">è„šæœ¬å·¥å…·</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">å½’æ¡£</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2025/08/"><span class="level-start"><span class="level-item">å…«æœˆ 2025</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/08/"><span class="level-start"><span class="level-item">å…«æœˆ 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/09/"><span class="level-start"><span class="level-item">ä¹æœˆ 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/08/"><span class="level-start"><span class="level-item">å…«æœˆ 2022</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/07/"><span class="level-start"><span class="level-item">ä¸ƒæœˆ 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/05/"><span class="level-start"><span class="level-item">äº”æœˆ 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/04/"><span class="level-start"><span class="level-item">å››æœˆ 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">æ€è€ƒè€…</a><p class="is-size-7"><span>&copy; 2025 ChenyangGao</span>Â Â Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>Â &amp;Â <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">å…±<span id="busuanzi_value_site_uv">0</span>ä¸ªè®¿å®¢</span></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="å›åˆ°é¡¶ç«¯" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "æ­¤ç½‘ç«™ä½¿ç”¨Cookieæ¥æ”¹å–„æ‚¨çš„ä½“éªŒã€‚",
          dismiss: "çŸ¥é“äº†ï¼",
          allow: "å…è®¸ä½¿ç”¨Cookie",
          deny: "æ‹’ç»",
          link: "äº†è§£æ›´å¤š",
          policy: "Cookieæ”¿ç­–",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/mhchem.min.js" defer></script><script>window.addEventListener("load", function() {
            document.querySelectorAll('[role="article"] > .content').forEach(function(element) {
                renderMathInElement(element);
            });
        });</script><script type="text/javascript" id="MathJax-script" async>MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      },
      chtml: {
        matchFontHeight: false
      }
    };</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js"></script><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update my browser now </a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">Ã—</a></p></div><script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>window.addEventListener("load", function () {
            outdatedBrowser({
                bgColor: '#f25648',
                color: '#ffffff',
                lowerThan: 'object-fit' // display on IE11 or below
            });
        });</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script src="/js/pjax.js"></script><!--!--><script data-pjax src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ..."></div><a class="searchbox-close" href="javascript:;">Ã—</a></div><div class="searchbox-body"></div></div></div><script data-pjax src="/js/insight.js" defer></script><script data-pjax>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ...","untitled":"(æ— æ ‡é¢˜)","posts":"æ–‡ç« ","pages":"é¡µé¢","categories":"åˆ†ç±»","tags":"æ ‡ç­¾"});
        });</script></body></html>